<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Ntoskrnl2333 -- 个人主页</title>
  <link rel="icon" href="favicon.png" sizes="16x16">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: "Microsoft YaHei", sans-serif;
      font-size: 1.25rem; /* 调大基础字体 */
    }
    .bg-gradient-custom {
      z-index: -999;
      background: linear-gradient(135deg, #08298b, #6202ab);
      position: sticky;
      top: 0px
    }
    .avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid #fff;
      margin-bottom: 10px;
    }
    .card-site {
      transition: transform 0.3s, box-shadow 0.3s;
      cursor: pointer;
      padding: 5px;
      opacity: 0;
      box-shadow: 0 11px 25px rgb(106, 1, 198);
      transform: translateY(30px);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border-radius: 20px;
      font-size: 1.15rem;  /* 卡片字体更大 */
    }
    .card-site.visible {
      opacity: 1;
      transform: translateY(0);
      transition: all 0.6s;
    }
    .card-site:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 15px 40px rgba(24, 105, 255, 0.7);
    }
    .card-site img {
      max-height: 100px;
      object-fit: contain;
      margin-bottom: 20px;
      margin-top: 20px; /* logo和card之间增加边距 */
      margin-left: auto;
      margin-right: auto;
      display: block;
    }
    .nav-link {
      color: #fff !important;
      font-weight: bold;
      font-size: 1.1rem; /* 导航字体更大 */
    }
    .nav-link:hover {
      color: #ffd700 !important;
    }
    h1, h2, h5 {
      font-size: 2.2rem; /* 标题字体更大 */
      font-weight: bold;
    }
    h2 {
      font-size: 1.8rem;
    }
    h5 {
      font-size: 1.3rem;
      font-weight: bold;
    }
    main-warpper{
      z-index: 999;
      height: 100%;
      width: 100%;
      top: 0;
      position: sticky;
      background: url("/images/starry_sky.jpg") center/cover no-repeat;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }
  </style>
</head>
<body>

<header class="bg-gradient-custom text-center py-5">
  <img src="favicon.png" alt="头像" class="avatar">
  <h1 class="mt-2 mb-1">Ntoskrnl2333</h1>
  <p class="mb-3">欢迎来到我的个人主页！</p>
  <nav class="mb-2">
    <a class="nav-link d-inline" href="https://github.com/ntoskrnl2333/ntoskrnl2333.github.io">编辑本页</a>
    <a class="nav-link d-inline" href="#sites">快捷链接</a>
    <a class="nav-link d-inline" href="#contact">联系我</a>
  </nav>
</header>

<main-warpper>
<main class="container my-5">
  <section id="sites">
    <h2 class="text-center mb-4">快捷链接</h2>
    <div class="row" id="siteGrid"></div>
  </section>

  <section id="contact" class="mt-5">
    <h2 class="text-center mb-4">联系我</h2>
    <!-- 可在此添加联系方式内容 -->
  </section>
</main>
</main-wrapper>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Quantize JS -->
<script src="quantize.js"></script>

<script>
  // 加载网站配置
  fetch("conf.json",{ cache: "reload" })
    .then(response => response.json())
    .then(data => {

			//临时canvas，用于图像处理
			const canvas = document.createElement('canvas');
			canvas.style.display = 'none'; // 隐藏 canvas

			document.body.appendChild(canvas); // 添加到页面中
			const ctx = canvas.getContext('2d');

      const grid = document.getElementById("siteGrid");
      for (const [name, site] of Object.entries(data.sites)) {
        const col = document.createElement("div");
        col.className = "col-12 col-sm-6 col-md-4 col-lg-3 mb-4";

        const card = document.createElement("div");
        card.className = "card card-site h-100 text-center";
				card.setAttribute('style', site.css);
        card.onclick = () => { window.location.href = site.address; };

        const img = document.createElement("img");
        img.src = site.logo;
        img.className = "card-img-top mx-auto d-block";
        img.alt = name;
        img.crossOrigin = "Anonymous";
        img.width = 60;
        img.height = 60;
        img.onload = function() {
					// 将图像绘制到 canvas 上
					canvas.width = img.width;
					canvas.height = img.height;
					ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
          const pixels = [];
					
					// 提取非透明像素的 RGB 值
          for (let i = 0; i < data.length; i += 4) {
            let r = data[i], g = data[i+1], b = data[i+2], a = data[i+3];
            if (a === 0) continue;
            pixels.push([r, g, b]);
    			}
					
					// 使用 quantize.js 进行颜色量化
					const colorMap = quantize(pixels, 16);
					const palette = colorMap.palette();

					// 统计每种颜色的频率
					const counts = new Map();
					for (let [r,g,b] of pixels) {
						const [nr, ng, nb] = colorMap.map([r,g,b]);
						const key = `${nr},${ng},${nb}`;
						counts.set(key, (counts.get(key) || 0) + 1);
					}

					// 按出现次数排序
					const sortedColors = [...counts.entries()]
						.sort((a, b) => b[1] - a[1]);
					
					sortedColors.forEach(([color, count]) => {
						const [r, g, b] = color.split(',').map(Number);
						const hex = "#" + [r, g, b].map(x => x.toString(16).padStart(2, "0")).join("");
						sortedColors[sortedColors.findIndex(([c]) => c === color)][0] = hex;
						const luminance = 0.299*r + 0.587*g + 0.114*b;
						//console.log(`Color: rgb(${r},${g},${b}), Count: ${count}, Luminance: ${luminance.toFixed(2)}`);
					});

					console.log(name,": Top 16 colors:", sortedColors);
        };

        const cardBody = document.createElement("div");
        cardBody.className = "card-body";

        const title = document.createElement("h5");
        title.className = "card-title";
        title.textContent = name;

        const desc = document.createElement("p");
        desc.className = "card-text text-secondary";
        desc.textContent = site.description;

        cardBody.appendChild(title);
        cardBody.appendChild(desc);
        card.appendChild(img);
        card.appendChild(cardBody);
        col.appendChild(card);
        grid.appendChild(col);
      }
      // 启动滚动动画
      initScrollAnimation();
    })
    .catch(err => {
      console.error("加载 conf.json 失败:", err);
    });

  // 滚动动画函数
  function initScrollAnimation() {
    const cards = document.querySelectorAll('.card-site');
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1 });

    cards.forEach(card => observer.observe(card));
  }
</script>

</body>
</html>
